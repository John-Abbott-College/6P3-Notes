<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-04-15">

<title>Connected Objects - IoT Communication Protocols</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../topics/iot/docs/what-is-iot.html" rel="next">
<link href="../../../topics/iot/docs/intro-azure-iot.html" rel="prev">
<link href="../../../assets/favicon_io/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script>
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Connected Objects - IoT Communication Protocols">
<meta property="og:description" content="How communication protocols can be optimized for device-cloud communication, i.e.&nbsp;why not everything should use HTTP">
<meta property="og:image" content="https://john-abbott-college.github.io/6P3-Notes/topics/iot/docs/assets/art_title_path_only.svg">
<meta property="og:site_name" content="Connected Objects">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/favicon_io/favicon-32x32.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Connected Objects</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../announcements/index.html"> 
<span class="menu-text">Announcements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about/calendar.html"> 
<span class="menu-text">Calendar</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about/syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../topics/index.html"> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-iconify-simple-icons-moodle-" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><iconify-icon inline="" icon="simple-icons:moodle" aria-label="Icon moodle from simple-icons Iconify.design set." title="Icon moodle from simple-icons Iconify.design set."></iconify-icon></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-iconify-simple-icons-moodle-">    
        <li>
    <a class="dropdown-item" href="https://moodle.johnabbott.qc.ca/course/view.php?id=807">
 <span class="dropdown-text">Section 1 (8h30)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://moodle.johnabbott.qc.ca/course/view.php?id=808">
 <span class="dropdown-text">Section 2 (13h30)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="../../../announcements/index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/John-Abbott-College/6P3-Notes"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:github" aria-label="Icon github from fa6-brands Iconify.design set." title="Icon github from fa6-brands Iconify.design set."></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../topics/index.html">Topics</a></li><li class="breadcrumb-item"><a href="../../../topics/iot/index.html">IoT</a></li><li class="breadcrumb-item"><a href="../../../topics/iot/docs/azure-cli-cheatsheet.html">Docs</a></li><li class="breadcrumb-item"><a href="../../../topics/iot/docs/iot-protocols.html">IoT Communication Protocols</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../announcements/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Announcements</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../about/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../about/calendar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calendar</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../about/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../about/this-site.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this website</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../topics/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../topics/iot/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IoT</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Docs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth3 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/iot/docs/azure-cli-cheatsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Azure CLI Cheatsheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/iot/docs/azure-sdks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Azure SDKs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/iot/docs/device-cloud-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Device to Cloud Communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/iot/docs/device-twins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Device Twins</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/iot/docs/intro-azure-iot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Azure IoT</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/iot/docs/iot-protocols.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">IoT Communication Protocols</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/iot/docs/what-is-iot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to the Internet of Things</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../topics/hardware/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hardware</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Docs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/hardware/docs/reterminal-sensors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">reTerminal Sensors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/hardware/docs/analog-vs-digital.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Signals: Analog and digital</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/hardware/docs/arduino-vs-raspberry-pi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SBCs and Microcontrollers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/hardware/docs/circuitry-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Electronics Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/hardware/docs/debug-black-screen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Debugging Black Screen Issue</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/hardware/docs/gpios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GPIOs: Inputs and Outputs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/hardware/docs/serial-protocols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Serial protocols</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../topics/getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Docs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/getting-started/docs/hardware-list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hardware List</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/getting-started/docs/tech-stack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Technology Stack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/getting-started/docs/vscode-python-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Developer setup</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../topics/python/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
 <span class="menu-text">Docs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/python/docs/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction (for developers)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/python/docs/package-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Package management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/python/docs/oop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OOP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/python/docs/scripting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scripting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/python/docs/project-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/python/docs/advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Asynchronous, REST API</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../topics/linux/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linux</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false">
 <span class="menu-text">Docs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/linux/docs/github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Some notes about GitHub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/linux/docs/linux-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linux review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/linux/docs/package-management-debian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raspberry Pi Package Management: apt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../topics/linux/docs/remote-linux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Remote work on Linux</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#http" id="toc-http" class="nav-link active" data-scroll-target="#http">HTTP</a>
  <ul>
  <li><a href="#typical-http-request" id="toc-typical-http-request" class="nav-link" data-scroll-target="#typical-http-request">Typical HTTP request</a></li>
  <li><a href="#typical-http-response" id="toc-typical-http-response" class="nav-link" data-scroll-target="#typical-http-response">Typical HTTP Response</a></li>
  <li><a href="#http-characteristics" id="toc-http-characteristics" class="nav-link" data-scroll-target="#http-characteristics">HTTP Characteristics</a></li>
  <li><a href="#dash-app-example" id="toc-dash-app-example" class="nav-link" data-scroll-target="#dash-app-example">Dash app example</a></li>
  </ul></li>
  <li><a href="#pubsub-communication" id="toc-pubsub-communication" class="nav-link" data-scroll-target="#pubsub-communication">Pub/Sub Communication</a>
  <ul>
  <li><a href="#clients" id="toc-clients" class="nav-link" data-scroll-target="#clients">Clients</a></li>
  <li><a href="#broker" id="toc-broker" class="nav-link" data-scroll-target="#broker">Broker</a></li>
  </ul></li>
  <li><a href="#mqtt" id="toc-mqtt" class="nav-link" data-scroll-target="#mqtt">MQTT</a>
  <ul>
  <li><a href="#topics-wildcards" id="toc-topics-wildcards" class="nav-link" data-scroll-target="#topics-wildcards">Topics &amp; Wildcards</a>
  <ul class="collapse">
  <li><a href="#wildcards" id="toc-wildcards" class="nav-link" data-scroll-target="#wildcards">Wildcards</a></li>
  </ul></li>
  <li><a href="#messages" id="toc-messages" class="nav-link" data-scroll-target="#messages">Messages</a></li>
  <li><a href="#qos" id="toc-qos" class="nav-link" data-scroll-target="#qos">QoS</a></li>
  <li><a href="#sessions-clean-or-persistent" id="toc-sessions-clean-or-persistent" class="nav-link" data-scroll-target="#sessions-clean-or-persistent">Sessions: Clean or Persistent</a></li>
  <li><a href="#keepalive" id="toc-keepalive" class="nav-link" data-scroll-target="#keepalive">KeepAlive</a></li>
  <li><a href="#last-will-testament" id="toc-last-will-testament" class="nav-link" data-scroll-target="#last-will-testament">Last Will &amp; Testament</a></li>
  <li><a href="#retained-messages" id="toc-retained-messages" class="nav-link" data-scroll-target="#retained-messages">Retained Messages</a></li>
  </ul></li>
  <li><a href="#http-vs-mqtt" id="toc-http-vs-mqtt" class="nav-link" data-scroll-target="#http-vs-mqtt">HTTP vs MQTT</a></li>
  <li><a href="#mqtt-client-examples" id="toc-mqtt-client-examples" class="nav-link" data-scroll-target="#mqtt-client-examples">MQTT Client Examples</a>
  <ul>
  <li><a href="#public-brokers" id="toc-public-brokers" class="nav-link" data-scroll-target="#public-brokers">Public Brokers</a></li>
  <li><a href="#publisher-code" id="toc-publisher-code" class="nav-link" data-scroll-target="#publisher-code">Publisher Code</a></li>
  <li><a href="#subscriber-code" id="toc-subscriber-code" class="nav-link" data-scroll-target="#subscriber-code">Subscriber Code</a></li>
  </ul></li>
  <li><a href="#connectivity-issues" id="toc-connectivity-issues" class="nav-link" data-scroll-target="#connectivity-issues">Connectivity Issues</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#references-resources" id="toc-references-resources" class="nav-link" data-scroll-target="#references-resources">References &amp; Resources</a>
  <ul>
  <li><a href="#diving-deeper" id="toc-diving-deeper" class="nav-link" data-scroll-target="#diving-deeper">Diving Deeper</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../topics/index.html">Topics</a></li><li class="breadcrumb-item"><a href="../../../topics/iot/index.html">IoT</a></li><li class="breadcrumb-item"><a href="../../../topics/iot/docs/azure-cli-cheatsheet.html">Docs</a></li><li class="breadcrumb-item"><a href="../../../topics/iot/docs/iot-protocols.html">IoT Communication Protocols</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">IoT Communication Protocols</h1>
<p class="subtitle lead">How communication protocols can be optimized for device-cloud communication, i.e.&nbsp;why not everything should use HTTP</p>
  <div class="quarto-categories">
    <div class="quarto-category">IOT</div>
    <div class="quarto-category">Quiz 2</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 15, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">May 10, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>IoT devices typically exchange data with a cloud service using a specific <strong>communication protocol</strong>.</p>
<blockquote class="blockquote">
<p>Data gathered from sensors and sent to the cloud is called <strong>telemetry</strong>.</p>
</blockquote>
<p>This section looks at common communication protocols used in IoT with a focus on <strong>MQTT</strong>.</p>
<section id="http" class="level2">
<h2 class="anchored" data-anchor-id="http">HTTP</h2>
<p>So far in this course we’ve been exchanging data between our devices and Python Flask/Dash servers using HTTP.</p>
<blockquote class="blockquote">
<p>The default web server instantiated by the Dash python library is a thin HTTP wrapper around the Flask web server.</p>
</blockquote>
<p>HTTP is a common protocol for the web, however, some of its characteristics make it not ideal for IoT applications, as the next section explains.</p>
<section id="typical-http-request" class="level3">
<h3 class="anchored" data-anchor-id="typical-http-request">Typical HTTP request</h3>
<img src="https://www3.ntu.edu.sg/home/ehchua/programming/webprogramming/images/HTTP_RequestMessageExample.png" class="img-fluid">
<p class="img-info">
<a href="https://cheapsslsecurity.com/p/http2-vs-http1/"> Example of an HTTP Request </a>&nbsp; cheapsslsecurity.com.
</p>
</section>
<section id="typical-http-response" class="level3">
<h3 class="anchored" data-anchor-id="typical-http-response">Typical HTTP Response</h3>
<img src="https://www3.ntu.edu.sg/home/ehchua/programming/webprogramming/images/HTTP_ResponseMessageExample.png" class="img-fluid">
<p class="img-info">
<a href="https://cheapsslsecurity.com/p/http2-vs-http1/"> Example of an HTTP Response </a>&nbsp; cheapsslsecurity.com.
</p>
<p>Below is the HTTP response header for the posting of AIO data above (1 KB long)</p>
</section>
<section id="http-characteristics" class="level3">
<h3 class="anchored" data-anchor-id="http-characteristics">HTTP Characteristics</h3>
<p>The following HTTP characteristics are relevant in the IoT context:</p>
<ul>
<li><strong>Request response protocol</strong>: client always has to request an update from the server.</li>
<li>Designed for <strong>large bandwidth</strong>, low delay.</li>
<li><strong>Stateless</strong>: each request is considered as the new request. Server doesn’t recognise the user by default (cookies or tokens are required).</li>
<li><strong>Resource identification</strong>: each request includes a URI (universal resource identifier).</li>
<li><strong>DNS lookup</strong>: 3-way identification handshake (overhead).</li>
<li><strong>Big protocol headers</strong>: uncompressed content transfer that is not the payload.</li>
</ul>
<p>In HTTP, the client has to be constantly “pulling” the server for new information. Pull updates are either slow (check only every few minutes) or data/power intensive (check constantly).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://cdn-learn.adafruit.com/assets/assets/000/049/264/medium800/customer___partner_projects_adafruit_io_polling.png?1513195213" class="lightbox" data-glightbox="description: .lightbox-desc-1" data-gallery="quarto-lightbox-gallery-1" title="customer___partner_projects_adafruit_io_polling.png"><img src="https://cdn-learn.adafruit.com/assets/assets/000/049/264/medium800/customer___partner_projects_adafruit_io_polling.png?1513195213" class="img-fluid figure-img" alt="customer___partner_projects_adafruit_io_polling.png"></a></p>
<figcaption>customer___partner_projects_adafruit_io_polling.png</figcaption>
</figure>
</div>
<p class="img-info">
<a href="https://learn.adafruit.com/alltheiot-protocols?view=all#internet-of-toast-2977937-4"> HTTP Client constantly pulling the server for updates </a>&nbsp; HTTP Protocol, Adafruit.
</p>
</section>
<section id="dash-app-example" class="level3">
<h3 class="anchored" data-anchor-id="dash-app-example">Dash app example</h3>
<p>In our dash apps, this problem showed up in the form of a strict dependency between the Dash app and the Device Controller – at each interval, the Dash app had to directly call the Device Controller “read_sensors” and “control_actuators” methods. This is fine in a simple example where it doesn’t matter that we poll the device each second, but on faster intervals, or when information is not aligned with regular intervals, this results in large inefficiencies.</p>
</section>
</section>
<section id="pubsub-communication" class="level2">
<h2 class="anchored" data-anchor-id="pubsub-communication">Pub/Sub Communication</h2>
<blockquote class="blockquote">
<p>The most popular communication pattern for IoT systems is a publish/subscribe (pub/sub) messaging system done via some kind of broker.</p>
</blockquote>
<p>This IoT system has two types of actors:</p>
<ul>
<li>One or more <strong>Clients</strong></li>
<li>One <strong>Broker</strong></li>
</ul>
<p>In the image below, a client device is publishing messages to the topic <code>/telemetry</code> while a client in the cloud is subscribed to the same topic.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/microsoft/IoT-For-Beginners/raw/main/images/mqtt.png" class="img-fluid figure-img"></p>
<figcaption>IoT device publishing telemetry on the /telemetry topic, and the cloud service subscribing to that topic</figcaption>
</figure>
</div>
<p>It’s very typical that any particular client is both the publisher and the subscriber.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/microsoft/IoT-For-Beginners/raw/main/images/pub-sub.png" class="img-fluid figure-img"></p>
<figcaption>IoT devices connect to a broker and publish telemetry and subscribe to commands. Cloud services connect to the broker and subscribe to all telemetry and send commands to specific devices.</figcaption>
</figure>
</div>
<p>Figures from: <a href="https://github.com/microsoft/IoT-For-Beginners/tree/main/1-getting-started/lessons/4-connect-internet">Broker and client relationship</a>, IoT for Beginners, Microsoft.</p>
<section id="clients" class="level3">
<h3 class="anchored" data-anchor-id="clients">Clients</h3>
<p><strong>Clients</strong> are typically devices, applications or back-end services. They connect to the broker and publish telemetry as well as subscribe to commands.</p>
<blockquote class="blockquote">
<p><strong>A cloud service is an example of a client</strong>.</p>
<p>It connects to the broker and subscribes to all the telemetry messages and publishes commands either to specific devices, or to groups of devices.</p>
</blockquote>
<p>The client performs two operations:</p>
<ul>
<li><strong>Publishes information:</strong> When the client sends the data to the server.</li>
<li><strong>Subscribes to information:</strong> When the client receives the data from the server.</li>
</ul>
</section>
<section id="broker" class="level3">
<h3 class="anchored" data-anchor-id="broker">Broker</h3>
<p>The Broker is typically running on a server and performs the following operations:</p>
<ul>
<li>Accepts messages from clients.</li>
<li>Processes subscribe and unsubscribe requests.</li>
<li>Forwards messages to specific clients according to subscription requests.</li>
</ul>
<blockquote class="blockquote">
<p>MQTT is the most popular communication protocol for IoT devices</p>
</blockquote>
</section>
</section>
<section id="mqtt" class="level2">
<h2 class="anchored" data-anchor-id="mqtt">MQTT</h2>
<p>Message Queueing Telemetry Transport, i.e.&nbsp;<a href="http://mqtt.org">MQTT</a>, is a lightweight pub/sub protocol. It was originally designed to monitor oil pipelines where connectivity could not be guaranteed.</p>
<p>One or more clients connect to a single broker, who routes messages to the interested clients.</p>
<p>MQTT manages messages <strong>asynchronously</strong> over a <strong>network socket</strong>.</p>
<p>The broker can hold and forward messages from client to client so if one gets disconnected, it will be able to fetch the message when it reconnects later.</p>
<blockquote class="blockquote">
<p><a href="https://engineering.fb.com/2011/08/12/android/building-facebook-messenger/">Facebook Messenger uses MQTT</a> and is the World’s largest MQTT network.</p>
<p>Infrastructure details <a href="https://engineering.fb.com/2014/10/09/production-engineering/building-mobile-first-infrastructure-for-messenger/">here</a> (nice read!).</p>
</blockquote>
<section id="topics-wildcards" class="level3">
<h3 class="anchored" data-anchor-id="topics-wildcards">Topics &amp; Wildcards</h3>
<p>Messages are routed using <strong>named topics</strong>, rather than being sent directly to an individual client. A client can publish to a topic, and any clients subscribed to that topic will receive the message.</p>
<p>In the example below, a <strong>client device is publishing</strong> some data (not shown) to the topic <code>/telemetry</code>. Immediately after the data is received by the broker, the <strong>broker routes the message</strong> to a client application previously <strong>subscribed to the same topic</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/microsoft/IoT-For-Beginners/raw/main/images/mqtt.png" class="img-fluid figure-img"></p>
<figcaption>IoT device publishing telemetry on the /telemetry topic, and the cloud service subscribing to that topic</figcaption>
</figure>
</div>
<p><a href="https://github.com/microsoft/IoT-For-Beginners/tree/main/1-getting-started/lessons/4-connect-internet"> MQTT Topics </a>&nbsp; IoT for Beginners, Microsoft.</p>
<blockquote class="blockquote">
<p>Topics <strong>typically have a hierarchy</strong> to keep data organized and intuitive to access.</p>
</blockquote>
<p>For example, a factory might want to track temperature from different HVAC units on different floor.</p>
<p>The topic hierarchy could be set up in the following way:</p>
<p><code>sensors/&lt;FLOOR&gt;/temperature/&lt;HVAC_UNIT_ID&gt;</code></p>
<p>HVAC units would publish data to the following topics:</p>
<ul>
<li>The AC unit on the third floor: <code>sensors/floor3/temperature/AC1</code></li>
<li>The boiler unit on the tenth floor: <code>sensors/floor10/temperature/boiler</code></li>
<li>The heater unit on the fourth floor: <code>sensors/floor4/temperature/heater</code></li>
</ul>
<section id="wildcards" class="level4">
<h4 class="anchored" data-anchor-id="wildcards">Wildcards</h4>
<p>Clients can subscribe to different levels of the topic hierarchy using <strong>wildcards</strong>.</p>
<p>When subscribing to multiple topics two <strong>wildcard</strong> characters can be used:</p>
<ul>
<li><strong># (hash character)</strong> – multi level wildcard</li>
<li><strong>+</strong> <strong>(plus character)</strong> -single level wildcard</li>
</ul>
<p>Using the previous factory temperature example, an application could monitor multiple temperatures in the following way:</p>
<table class="table">
<colgroup>
<col style="width: 37%">
<col style="width: 62%">
</colgroup>
<thead>
<tr class="header">
<th>Topic string</th>
<th>Subscription result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sensors/floor3/temperature/+</code></td>
<td><strong>All</strong> of the temperature sensors on the 3rd floor</td>
</tr>
<tr class="even">
<td><code>sensors/+/temperature/+</code></td>
<td><strong>All</strong> the temperature data on <strong>all</strong> floors</td>
</tr>
<tr class="odd">
<td><code>sensors/#</code></td>
<td><strong>All</strong> topics going on <strong>all</strong> floors</td>
</tr>
<tr class="even">
<td><code>sensors/floor10/#</code></td>
<td><strong>All</strong> topics of the tenth floor</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="messages" class="level3">
<h3 class="anchored" data-anchor-id="messages">Messages</h3>
<p>Like to HTTP, MQTT is built on top of TCP/IP and can also be used over websockets.</p>
<p>MQTT messages can be as short as 2 bytes (eg. acknowledgement or disconnect messages), as big as 256Mb (eg. publishing a picture or firmware update).</p>
<p>A typical telemetry message with payload data such as <code>value=40</code> to a topic <code>/assign1-temp</code> has a size around 20 to 40 bytes.</p>
<blockquote class="blockquote">
<p>Message headers and topic names are text encoded (UTF-8).</p>
<p>Message payload encoding is specific to the application (eg. plain text, JSON, binary, etc)</p>
</blockquote>
<p>MQTT connections can be <strong>public and open, or encrypted and secured</strong> using usernames and passwords, or certificates.</p>
</section>
<section id="qos" class="level3">
<h3 class="anchored" data-anchor-id="qos">QoS</h3>
<p>Messages can be sent with a quality of service (QoS) flag, which determines the guarantee of the message being received.</p>
<ul>
<li><p><strong>QoS 0: At most once (Fire and Forget)</strong> - the message is sent only once and the client and broker take no additional steps to acknowledge delivery (fire and forget).</p></li>
<li><p><strong>QoS 1: At least once</strong> - the message is re-tried by the sender multiple times until acknowledgement is received (acknowledged delivery).</p></li>
<li><p><strong>QoS 2: Exactly once</strong> - the sender and receiver engage in a two-level handshake to ensure only one copy of the message is received (assured delivery).</p></li>
</ul>
<p>Below is an example of <strong>QoS 1</strong>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://cdn-learn.adafruit.com/assets/assets/000/049/303/medium800/customer___partner_projects_adafruit_io_puback.png?1513286630" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="quarto-lightbox-gallery-5" title="customer___partner_projects_adafruit_io_puback.png"><img src="https://cdn-learn.adafruit.com/assets/assets/000/049/303/medium800/customer___partner_projects_adafruit_io_puback.png?1513286630" class="img-fluid figure-img" alt="customer___partner_projects_adafruit_io_puback.png"></a></p>
<figcaption>customer___partner_projects_adafruit_io_puback.png</figcaption>
</figure>
</div>
<p class="img-info">
<a href="https://learn.adafruit.com/alltheiot-protocols/mqtt-qos"> Example of ‘At Least Once’ (QoS 1) delivery </a>&nbsp; MQTT QoS, Adafruit.
</p>
<blockquote class="blockquote">
<p>By default MQTT sessions are established with QoS 0 for all messages (clean sessions).</p>
<p>This means that if a client disconnects and then reconnects, <strong>it won’t receive messages sent during the disconnection</strong>.</p>
</blockquote>
<p>When setting QoS, there are two sides of message delivery:</p>
<ol type="1">
<li>Message delivery from the publishing client to the broker.</li>
<li>Message delivery from the broker to the subscribing client.</li>
</ol>
<p>The client that publishes the message to the broker defines the QoS level of the message when it sends the message to the broker.</p>
<p>The broker transmits this message to subscribing clients <strong>using the QoS level that each subscribing client defines</strong> during the subscription process.</p>
<blockquote class="blockquote">
<p>If the subscribing client defines a lower QoS than the publishing client, the broker transmits the message with the lower quality of service.</p>
</blockquote>
</section>
<section id="sessions-clean-or-persistent" class="level3">
<h3 class="anchored" data-anchor-id="sessions-clean-or-persistent">Sessions: Clean or Persistent</h3>
<p>Typically, a client-broker connection is established with the session flag set to <strong>Clean</strong> with <code>CleanSession = true</code> (however, this is specific to the library implementation).</p>
<p>In this case the broker does not store anything for the client and purges all information from any previous subscriptions.</p>
<p>In a persistent session (<code>CleanSession = false</code>), the broker stores all subscriptions for the client and all missed messages for the client <strong>IF it subscribed with a QoS level 1 or 2</strong>.</p>
</section>
<section id="keepalive" class="level3">
<h3 class="anchored" data-anchor-id="keepalive">KeepAlive</h3>
<p>The keep alive flag is <strong>a time interval in seconds</strong> that the client specifies and communicates to the broker when the connection established.</p>
<p>This is longest period of time that the broker and client can go without <strong>pinging each other</strong>. This method allows both sides to determine if the session is still available.</p>
</section>
<section id="last-will-testament" class="level3">
<h3 class="anchored" data-anchor-id="last-will-testament">Last Will &amp; Testament</h3>
<p>When a client connects, it can provide the broker with a Last Will and Testament (LWT) message and topic.</p>
<p>If the client disconnects unexpectedly, the broker sends the LWT message on behalf of the client.</p>
<p><strong>This message notifies other clients when a client disconnects unexpectedly.</strong></p>
<img src="../assets/11-iot-protocols-last-will.png" class="img-fluid">
<p class="img-info">
<a href="https://www.youtube.com/watch?v=LKz1jYngpcU"> Last Will &amp; Testament </a>&nbsp; Why HTTP isn’t the King of the IoT, Robert Bird, Akamai.
</p>
</section>
<section id="retained-messages" class="level3">
<h3 class="anchored" data-anchor-id="retained-messages">Retained Messages</h3>
<p>A retained message is <strong>a normal MQTT message with the retained flag set to true</strong>.</p>
<p>The broker stores the last retained message and the corresponding QoS for that topic.</p>
<p>Each client that subscribes to a topic pattern that matches the topic of the retained message receives the retained message immediately after they subscribe.</p>
<p>The broker stores only one retained message per topic.</p>
<blockquote class="blockquote">
<p>Retained messages help newly-subscribed clients get a status update immediately after they subscribe to a topic.</p>
</blockquote>
<img src="../assets/11-iot-protocols-retained.png" class="img-fluid">
<p class="img-info">
<a href="https://www.youtube.com/watch?v=LKz1jYngpcU"> Message with Retained Flag </a>&nbsp; Why HTTP isn’t the King of the IoT, Robert Bird, Akamai.
</p>
</section>
</section>
<section id="http-vs-mqtt" class="level2">
<h2 class="anchored" data-anchor-id="http-vs-mqtt">HTTP vs MQTT</h2>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 47%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Criteria</th>
<th>MQTT</th>
<th>HTTP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Complexity</td>
<td>Simple and lightweight</td>
<td>More complex and slightly heavier</td>
</tr>
<tr class="even">
<td>Consumption</td>
<td>More energy efficient</td>
<td>Less energy efficient</td>
</tr>
<tr class="odd">
<td>Communication direction</td>
<td>Bi-directional (client or broker can initiate)</td>
<td>Uni-directional (client must initiate)</td>
</tr>
<tr class="even">
<td>Architecture</td>
<td>Publish / Subscribe model</td>
<td>Request / Response Model</td>
</tr>
<tr class="odd">
<td>Session</td>
<td>Can keep connection open</td>
<td>Connection closes after every request</td>
</tr>
<tr class="even">
<td>Delivery assurance</td>
<td>Reliable message delivery with QoS (Quality of Service)</td>
<td>No QoS option</td>
</tr>
<tr class="odd">
<td>Header size</td>
<td>Smaller (~2 bytes)</td>
<td>Comparatively large size (~8 bytes)</td>
</tr>
</tbody>
</table>
</section>
<section id="mqtt-client-examples" class="level2">
<h2 class="anchored" data-anchor-id="mqtt-client-examples">MQTT Client Examples</h2>
<blockquote class="blockquote">
<p>Examples of <strong>graphical</strong> MQTT clients: - <a href="https://mqttx.app/">MQTT X</a> (supports <code>cleanSession = False</code>) - <a href="https://mqtt-explorer.com/">MQTT Explorer</a> - VS Code <a href="https://marketplace.visualstudio.com/items?itemName=rpdswtk.vsmqtt">Extension VSMqtt</a> t</p>
</blockquote>
<p>In this course you will write your own MQTT client. The next sections show an example of a simple MQTT client using Python that publishes and subscribes to messages.</p>
<section id="public-brokers" class="level3">
<h3 class="anchored" data-anchor-id="public-brokers">Public Brokers</h3>
<p>Since a broker is necessary, we can use the following publicly available MQTT brokers:</p>
<ul>
<li><a href="https://test.mosquitto.org">test.mosquitto.org</a> by Eclipse Foundation.</li>
<li><a href="https://www.emqx.com/en/mqtt/public-mqtt5-broker">broker.emqx.io</a> by EMQX.</li>
</ul>
<blockquote class="blockquote">
<p>For the client implementation we will use the <a href="https://github.com/eclipse/paho.mqtt.python">Eclipse Paho MQTT Python Client</a>. It is a popular choice for many IoT Cloud services such as Adafruit IO.</p>
<ul>
<li>Documentation for the <code>paho-mqtt</code> client is available at the <a href="https://pypi.org/project/paho-mqtt/#constructor-reinitialise">Pypi page</a>.</li>
</ul>
</blockquote>
<p>However, there are lots of other implementation options.</p>
<blockquote class="blockquote">
<p>This <a href="https://mqtt.org/software/">link compiles a list</a> of open-source MQTT client and broker implementations you can use in your projects.</p>
</blockquote>
</section>
<section id="publisher-code" class="level3">
<h3 class="anchored" data-anchor-id="publisher-code">Publisher Code</h3>
<p>The first example will only publish random data to the broker every 3 seconds.</p>
<ol type="1">
<li>Install the <code>paho-python</code> library.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install paho-mqtt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Create your script file. A few notes:</li>
</ol>
<ul>
<li>Create a unique client ID to avoid conflicts with other users (this is a public broker).
<ul>
<li>https://test.mosquitto.org/</li>
<li>Create a unique ID using the <a href="https://www.guidgen.com/">Online GUID generator</a></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>common_key <span class="op">=</span> <span class="st">'329adb05-8b85-4ebe-8309-15c564503a1f'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>To have a unique client name and topic, we will combine the key from above with the desired name and topic.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>client_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'publisher'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>topic_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'/temperature'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Import <code>paho-python</code> and the built-in <code>json</code> library (we’ll encode our data as JSON).</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>All network operations (incoming and outgoing data) are processed with the <code>loop()</code> method every 3 seconds.</li>
</ul>
<p>Complete code:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Publish to data topic (fire &amp; forget)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>rnd <span class="op">=</span> random.Random()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>common_key <span class="op">=</span> <span class="st">'d5a4d5e6-d597-4bd4-8196-5f51d12345'</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>topic_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'/temperature'</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>client_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'publisher'</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>mqtt_client <span class="op">=</span> mqtt.Client(client_name)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>mqtt_client.<span class="ex">connect</span>(<span class="st">'test.mosquitto.org'</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MQTT connected!"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random integer between -10 and 30</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> rnd.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare json payload</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> json.dumps({<span class="st">'temperature'</span>: temp})</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Sending telemetry "</span>, payload)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Send it off. QoS=0 and Retain=false</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> mqtt_client.publish(topic_name, payload)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process network event. Handles incoming/outgoing data</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    mqtt_client.loop()</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="subscriber-code" class="level3">
<h3 class="anchored" data-anchor-id="subscriber-code">Subscriber Code</h3>
<p>The MQTT client below subscribes to data from the publisher using the <strong>library’s default values</strong>.</p>
<p>A few notes:</p>
<ul>
<li>The subscriber used the same unique key as the publisher in order to subscribe to the same topics. However, the subscriber has its own client name.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>common_key <span class="op">=</span> <span class="st">'d5a4d5e6-d597-4bd4-8196-5f51d12345'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>topic_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'/temperature'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>client_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'subscriber'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Once the client receives a message from the broker, the method <code>on_message</code> is called. This is used as a hook to define our own callback function.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Callback for when a message is received</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> message_received(mqtt_client, userdata, message):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Received message: </span><span class="sc">{</span>message<span class="sc">.</span>payload<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Callback hook</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_message <span class="op">=</span> message_received</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Similarly to the publisher example, the network loop is processed every 1 second.</li>
</ul>
<p>The complete subscriber code:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subscribe to a topic with library's default values.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>common_key <span class="op">=</span> <span class="st">'d5a4d5e6-d597-4bd4-8196-5f51d12345'</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>client_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'subscriber'</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>topic_name <span class="op">=</span> common_key <span class="op">+</span> <span class="st">'/temperature'</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>mqtt_client <span class="op">=</span> mqtt.Client(client_name)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>mqtt_client.<span class="ex">connect</span>(<span class="st">'test.mosquitto.org'</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MQTT connected!"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Callback for when a message is received</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> message_received(mqtt_client, userdata, message):</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Received message: </span><span class="sc">{</span>message<span class="sc">.</span>payload<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Callback hook</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_message <span class="op">=</span> message_received</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>mqtt_client.subscribe(topic_name)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process network event. Handles incoming/outgoing data</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    mqtt_client.loop()</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="connectivity-issues" class="level2">
<h2 class="anchored" data-anchor-id="connectivity-issues">Connectivity Issues</h2>
<p>Connectivity is not always guaranteed. Things to think about when coding your application:</p>
<p><strong>What happens if:</strong> - Connection is lost just prior to telemetry being published? - Client connection is lost just prior to broker forwarding messages?</p>
<p><strong>How to make sure that:</strong> - The broker has received the most up to date telemetry data? - Client has the most recent command/data?</p>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<ol type="1">
<li>Use a Graphical MQTT client such as <a href="https://mqttx.app/">MQTT X</a>, <a href="https://mqtt-explorer.com/">MQTT Explorer</a> or the VS Code <a href="https://marketplace.visualstudio.com/items?itemName=rpdswtk.vsmqtt">Extension VSMqtt</a> to publish and subscribe telemetry data to/from one of our Adafruit IO (AIO) feeds.
<ol type="1">
<li>See the <a href="https://io.adafruit.com/api/docs/mqtt.html#adafruit-io-mqtt-api">AIO MQTT API</a> documentation.</li>
<li>Publish a MQTT message with a random value to one of your feeds.</li>
<li>Subscribe to one of your AIO feeds.</li>
<li>Using the AIO Web interface, write a value to feed you subscribed in the previous step. Your MQTT client should receive the new value as a published message</li>
</ol></li>
<li>Use a Graphical MQTT client (see previous question) to publish and subscribe to topics using the public <a href="https://test.mosquitto.org/">MQTT Mosquitto broker</a>.
<ol type="1">
<li>Use the <a href="https://www.guidgen.com/">Online GUID generator</a> to generate a unique prefix to your username.</li>
<li>Come-up with new topics and post new messages to them.</li>
<li>Subscribe to the same topics and see the new messages appear.</li>
</ol></li>
</ol>
</section>
<section id="references-resources" class="level2">
<h2 class="anchored" data-anchor-id="references-resources">References &amp; Resources</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/shqLy8XjqAQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<iframe width="560" height="315" src="https://www.youtube.com/embed/LKz1jYngpcU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<p><a href="https://learn.adafruit.com/alltheiot-protocols?view=all#mqtt">All the Internet of Things - Episode Two: Protocols</a>, by Adafruit and Digikey</p>
<p><a href="https://github.com/microsoft/IoT-For-Beginners/tree/main/1-getting-started/lessons/4-connect-internet">Lesson 4: connect your device to the Internet</a>, IoT for Beginners by Microsoft</p>
<p><a href="https://www.hivemq.com/blog/mqtt-essentials-part-3-client-broker-connection-establishment/">MQTT Client and Broker and MQTT Server and Connection Establishment Explained</a> by HiveMQ</p>
<section id="diving-deeper" class="level3">
<h3 class="anchored" data-anchor-id="diving-deeper">Diving Deeper</h3>
<p><a href="https://openlabpro.com/guide/mqtt-packet-format/">MQTT Packet Format</a> by OpenLab</p>
<p><a href="http://www.steves-internet-guide.com/mqtt-protocol-messages-overview/">Understanding the MQTT Protocol Packet Structure</a> by steves-internet-guide.com</p>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">customer___partner_projects_adafruit_io_polling.png</span>
<span class="glightbox-desc lightbox-desc-2">IoT device publishing telemetry on the /telemetry topic, and the cloud service subscribing to that topic</span>
<span class="glightbox-desc lightbox-desc-3">IoT devices connect to a broker and publish telemetry and subscribe to commands. Cloud services connect to the broker and subscribe to all telemetry and send commands to specific devices.</span>
<span class="glightbox-desc lightbox-desc-4">IoT device publishing telemetry on the /telemetry topic, and the cloud service subscribing to that topic</span>
<span class="glightbox-desc lightbox-desc-5">customer___partner_projects_adafruit_io_puback.png</span>
</div>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/john-abbott-college\.github\.io\/6P3-Notes\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../topics/iot/docs/intro-azure-iot.html" class="pagination-link" aria-label="Intro to Azure IoT">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Intro to Azure IoT</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../topics/iot/docs/what-is-iot.html" class="pagination-link" aria-label="Intro to the Internet of Things">
        <span class="nav-page-text">Intro to the Internet of Things</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../about/this-site.html">
<p>About</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../about/this-site.html#copyright">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/john-abbott-college/6P3-Notes/">
<p>Source</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../../announcements/index.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/John-Abbott-College/6P3-Notes">
<p><iconify-icon inline="" icon="fa6-brands:github" aria-label="Icon github from fa6-brands Iconify.design set." title="Icon github from fa6-brands Iconify.design set."></iconify-icon></p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","closeEffect":"zoom","loop":false,"openEffect":"zoom","descPosition":"bottom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>